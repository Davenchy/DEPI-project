FROM jenkins/jenkins:alpine

VOLUME [ "/var/run/docker.sock" ]

USER jenkins

RUN jenkins-plugin-cli --plugins "gogs-webhook slack ansible docker-workflow"

USER root

RUN apk add --no-cache docker-cli docker-cli-buildx ansible

COPY jenkins_entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chown root:jenkins /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh

ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]
